"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["4867"],{1414:function(n,e,s){s.r(e),s.d(e,{metadata:()=>t,default:()=>g,frontMatter:()=>a,contentTitle:()=>c,toc:()=>u,assets:()=>p});var t=JSON.parse('{"id":"snippets/JavaScript/request","title":"request \u5C01\u88C5","description":"axios \u5C01\u88C5","source":"@site/docs/snippets/JavaScript/request.mdx","sourceDirName":"snippets/JavaScript","slug":"/snippets/JavaScript/request","permalink":"/website/docs/snippets/JavaScript/request","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"nav":{"title":"\u4EE3\u7801\u7247\u6BB5","order":1},"group":{"title":"request\u5C01\u88C5","order":2},"toc":"content","tocDepth":3},"sidebar":"snippetsSidebar","previous":{"title":"jsutils \u5C01\u88C5","permalink":"/website/docs/snippets/JavaScript/jsutil"},"next":{"title":"\u4F7F\u7528 scss \u5B9E\u73B0 tailwind \u7684\u6837\u5F0F","permalink":"/website/docs/snippets/css/tailwind"}}'),i=s(7259),r=s(8682),o=s(8557);let a={nav:{title:"\u4EE3\u7801\u7247\u6BB5",order:1},group:{title:"request\u5C01\u88C5",order:2},toc:"content",tocDepth:3},c="request \u5C01\u88C5",p={},u=[{value:"axios \u5C01\u88C5",id:"axios-\u5C01\u88C5",level:2},{value:"uniapp request \u5C01\u88C5",id:"uniapp-request-\u5C01\u88C5",level:2}];function l(n){let e={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"request-\u5C01\u88C5",children:"request \u5C01\u88C5"})}),"\n",(0,i.jsx)(e.h2,{id:"axios-\u5C01\u88C5",children:"axios \u5C01\u88C5"}),"\n",(0,i.jsxs)(e.p,{children:["\u5C01\u88C5 axios \u7684\u4E3B\u8981\u4F5C\u7528\uFF0C\u6211\u8BA4\u4E3A\u4F53\u73B0\u5728\u56E2\u961F\u5408\u4F5C\u7684\u65F6\u5019\uFF0C\u80FD\u591F\u7EDF\u4E00\u4EE3\u7801\u3002",(0,i.jsx)(e.br,{}),"\n","\u5176\u6B21\u662F\u5728 axios \u4E0A\u5305\u4E86\u4E00\u5C42\uFF0C\u5982\u679C\u4EE5\u540E\u4E0D\u7528 axios \u4E86\uFF0C\u66F4\u5BB9\u6613\u66FF\u6362\uFF08\u8FD9\u662F\u4F2A\u9700\u6C42\u4E86\uFF0Caxios \u5C31\u7B97\u4E0D\u7EF4\u62A4\u4E86\u4E5F\u80FD\u6491\u51E0\u5E74\uFF09",(0,i.jsx)(e.br,{}),"\n","\u5728 ts \u4E0B\u5C01\u88C5\u8FD8\u6709\u4E00\u4E2A\u597D\u5904\u662F\u63D0\u4F9B\u7C7B\u578B\u63D0\u793A\uFF0C\u4F46\u662F axios \u672C\u6765\u5C31\u662F ts \u5199\u7684\uFF0C\u672C\u8EAB\u5C31\u652F\u6301\u7C7B\u578B\u63D0\u793A\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u6240\u4EE5\uFF0C\u6211\u8BA4\u4E3A\u5728\u6CA1\u6709\u56E2\u961F\u5408\u4F5C\u7684\u60C5\u51B5\u4E0B\uFF0C\u6CA1\u5FC5\u8981\u5C01\u88C5 axios\u3002\u521B\u5EFA\u4E00\u4E2A\u5B9E\u4F8B\u7528\u5B98\u65B9\u7684\u62E6\u622A\u5668\u5C31\u80FD\u5B9E\u73B0\u5927\u90E8\u5206\u529F\u80FD\u4E86\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u56E0\u4E3A\u6211\u89C9\u5F97\u62E6\u622A\u5668\u5C31\u80FD\u5B9E\u73B0\u9700\u6C42\u4E86\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u7C7B\u7684\u5C01\u88C5\uFF0C\u4E5F\u53EA\u662F\u7B80\u5355\u5305\u4E00\u5C42\uFF0C\u52A0\u4E0A\u7C7B\u578B\u63D0\u793A\u800C\u5DF2\u3002\u5BF9\u4E8E axios \u7684\u4F7F\u7528\u51E0\u4E4E\u6CA1\u6709\u5F71\u54CD\uFF0C\u53EA\u662F\u9650\u5236\u53EA\u662F\u7528 4 \u79CD\u56FA\u5B9A\u7684\u8BF7\u6C42\u3002\u3002\u3002"}),"\n","\n",(0,i.jsx)(o.A,{language:"ts",children:"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport axios from 'axios'\nimport type {\n  AxiosError,\n  AxiosInstance,\n  AxiosProgressEvent,\n  AxiosRequestConfig,\n  AxiosResponse,\n} from 'axios'\n\n// \u5C01\u88C5\u540E\u7AEF\u8FD4\u56DE\u503C\u7C7B\u578B\nexport type ResponseData<T> = {\n  code: number\n  msg: string\n  data: T\n}\n\nexport function downloadFile(res: Blob, filename: string) {\n  const blobUrl = window.URL.createObjectURL(new Blob([res]))\n  const a = document.createElement('a')\n  a.style.display = 'none'\n  a.href = blobUrl\n  a.download = filename\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  window.URL.revokeObjectURL(blobUrl) // \u91CA\u653Eblob\u5BF9\u8C61\n}\n\n/**\n * \u5C06\u6587\u4EF6\u5927\u5C0F\u6570\u5B57\u4F7F\u7528\u5408\u9002\u7684\u5355\u4F4D\u683C\u5F0F\u5316\u3002\n * @param filesize  \u5B57\u8282\u5927\u5C0F\n * @param decimalPlaces  \u5C0F\u6570\u4F4D\u6570\n * @returns\n */\nexport function filesizeFormatter(filesize: number, decimalPlaces = 2) {\n  const sizedict = {\n    b: 1,\n    kb: 1 << 10,\n    mb: 1 << 20,\n    gb: 1 << 30,\n    tb: Math.pow(1024, 4),\n    pb: Math.pow(1024, 5),\n  }\n  type SizeUnit = keyof typeof sizedict\n  let unit: Uppercase<SizeUnit> = 'B'\n  if (filesize >= sizedict.pb) {\n    unit = 'PB'\n  } else if (filesize >= sizedict.tb) {\n    unit = 'TB'\n  } else if (filesize >= sizedict.gb) {\n    unit = 'GB'\n  } else if (filesize >= sizedict.mb) {\n    unit = 'MB'\n  } else if (filesize >= sizedict.kb) {\n    unit = 'KB'\n  } else {\n    unit = 'B'\n  }\n  return (\n    (filesize / sizedict[unit.toLowerCase() as SizeUnit]).toFixed(\n      decimalPlaces\n    ) + unit\n  )\n}\n/**\n * \u683C\u5F0F\u5316\u4E0B\u8F7D\u8FDB\u5EA6log\u4FE1\u606F\n * @param progressEvent\n * @returns\n */\nexport function formatProgressMsg(progressEvent: AxiosProgressEvent) {\n  return `\u4E0B\u8F7D\u8FDB\u5EA6:${((progressEvent.progress ?? 0) * 100).toPrecision(\n    4\n  )}% Speed:${filesizeFormatter(progressEvent.rate ?? 0)}/s`\n}\n\n/**\n * \u901A\u7528\u5904\u7406\u4E0B\u8F7D\u8FDB\u5EA6\u7684\u51FD\u6570\n * @param progressEvent\n */\nexport function handleDownloadProgress(progressEvent: AxiosProgressEvent) {\n  const progressMsg = formatProgressMsg(progressEvent)\n  console.log(progressMsg)\n}\n\nexport class Request {\n  // axios \u5B9E\u4F8B\n  private instance: AxiosInstance\n  // \u9ED8\u8BA4\u914D\u7F6E\n  private baseConfig = {\n    baseURL: '/api',\n    timeout: 5000,\n    withCredentials: true,\n  }\n\n  constructor(config: AxiosRequestConfig) {\n    this.instance = axios.create(Object.assign(this.baseConfig, config))\n\n    // \u8BF7\u6C42\u62E6\u622A\u5668\n    this.instance.interceptors.request.use(\n      function (config) {\n        // \u8FD9\u91CC\u53EF\u4EE5\u8BBE\u7F6E\u8BF7\u6C42\u4FE1\u606F\uFF0C\u6BD4\u5982\u5728\u5934\u90E8\u6DFB\u52A0\u767B\u5F55\u7684token\n        // const loginStorage = getLocalstorage('userInfo') as LoginRes | null\n        // // \u53D6\u5F97token\u4EE5\u540E\u8FDB\u884C\u6DFB\u52A0\n        // if (loginStorage) {\n        //   // \u6DFB\u52A0Authorization\u8BF7\u6C42\u5934\u7528\u4E8E\u767B\u5F55\u8BA4\u8BC1\n        //   const { token } = loginStorage\n        //   if (token && config.headers) {\n        //     ;(config.headers as { [key: string]: unknown })['x-token'] = token\n        //   }\n        // }\n        return config\n      },\n      function (error: AxiosError) {\n        // \u8BF7\u6C42\u9519\u8BEF\uFF0C\u8FD9\u91CC\u53EF\u4EE5\u7528\u5168\u5C40\u63D0\u793A\u6846\u8FDB\u884C\u63D0\u793A\n        return Promise.reject(error)\n      }\n    )\n\n    // \u6DFB\u52A0\u54CD\u5E94\u62E6\u622A\u5668\n    this.instance.interceptors.response.use(\n      function (response) {\n        // \u5BF9\u54CD\u5E94\u6570\u636E\u505A\u70B9\u4EC0\u4E48\n        console.log(\n          `%c${response.config.url}`,\n          'background:#2d8cf0; padding: 2px; border-radius: 4px;color: #fff;',\n          response.data,\n          {\n            response,\n          }\n        )\n        if (response.request.responseType === 'blob') {\n          return response\n        }\n        return response.data\n      },\n      // \u4EFB\u4F55\u8D85\u8FC72xx\u8303\u56F4\u7684\u72B6\u6001\u7801\uFF0C\u4F1A\u89E6\u53D1\u8FD9\u4E2A\u51FD\u6570\n      // \u8FD9\u91CC\u7528\u6765\u5904\u7406http\u5E38\u89C1\u9519\u8BEF\uFF0C\u8FDB\u884C\u5168\u5C40\u63D0\u793A\n      function (error) {\n        let message = ''\n        switch (error.response.status) {\n          case 400:\n            message = '\u8BF7\u6C42\u9519\u8BEF(400)'\n            break\n          case 401:\n            message = '\u672A\u6388\u6743\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55(401)'\n            // \u8FD9\u91CC\u53EF\u4EE5\u505A\u6E05\u7A7Astorage\u5E76\u8DF3\u8F6C\u5230\u767B\u5F55\u9875\u7684\u64CD\u4F5C\n            // delLocalStorage('userInfo')\n            // window.location.reload()\n            break\n          case 403:\n            message = '\u62D2\u7EDD\u8BBF\u95EE(403)'\n            break\n          case 404:\n            message = '\u8BF7\u6C42\u51FA\u9519(404)'\n            break\n          case 408:\n            message = '\u8BF7\u6C42\u8D85\u65F6(408)'\n            break\n          case 500:\n            message = '\u670D\u52A1\u5668\u9519\u8BEF(500)'\n            break\n          case 501:\n            message = '\u670D\u52A1\u672A\u5B9E\u73B0(501)'\n            break\n          case 502:\n            message = '\u7F51\u7EDC\u9519\u8BEF(502)'\n            break\n          case 503:\n            message = '\u670D\u52A1\u4E0D\u53EF\u7528(503)'\n            break\n          case 504:\n            message = '\u7F51\u7EDC\u8D85\u65F6(504)'\n            break\n          case 505:\n            message = 'HTTP\u7248\u672C\u4E0D\u53D7\u652F\u6301(505)'\n            break\n          default:\n            message = `\u8FDE\u63A5\u51FA\u9519(${error.response.status})!`\n        }\n\n        // \u8FD9\u91CC\u6211\u4EEC\u53EF\u4EE5\u5F39\u51FA\u5168\u5C40\u62A5\u9519\u63D0\u793A\n        // notification.error({\n        //   message: message,\n        //   description: error?.response?.data?.msg ?? '\u670D\u52A1\u7AEF\u5F02\u5E38',\n        // })\n      }\n    )\n  }\n\n  // \u5B9A\u4E49\u6838\u5FC3\u8BF7\u6C42\n  public async request(config: AxiosRequestConfig): Promise<AxiosResponse> {\n    return this.instance.request(config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public async get<T = any>(\n    url: string,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.get(url, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public async post<T = any>(\n    url: string,\n    // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n    data?: any,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.post(url, data, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public async put<T = any>(\n    url: string,\n    // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n    data?: any,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.put(url, data, config)\n  }\n\n  // rome-ignore lint/suspicious/noExplicitAny: <explanation>\n  public async delete<T = any>(\n    url: string,\n    config?: AxiosRequestConfig\n  ): Promise<ResponseData<T>> {\n    return this.instance.delete(url, config)\n  }\n}\n\nexport default new Request({})\n"}),"\n",(0,i.jsx)(e.h2,{id:"uniapp-request-\u5C01\u88C5",children:"uniapp request \u5C01\u88C5"}),"\n",(0,i.jsxs)(e.p,{children:["uniapp \u7684 request\uFF0C\u662F\u56DE\u8C03\u51FD\u6570\u7684\u5F62\u5F0F\u3002 \u5982\u679C\u4E0D\u8FDB\u884C\u5C01\u88C5\u4F7F\u7528\uFF0C\u5F88\u5BB9\u6613\u9020\u6210\u56DE\u8C03\u5730\u72F1\u3002",(0,i.jsx)(e.br,{}),"\n","\u56E0\u4E3A uniapp \u652F\u6301 promise \u548C async await\uFF0C\u56E0\u4E3A\u6211\u8981\u540C\u65F6\u7EF4\u62A4\u5C0F\u7A0B\u5E8F\u548C pc \u7AEF\u7684\u63A5\u53E3\uFF0C\u6240\u4EE5\u5C01\u88C5\u6210\u7EDF\u4E00\u7684 async \u51FD\u6570\u6BD4\u8F83\u5408\u9002\u3002",(0,i.jsx)(e.br,{}),"\n","\u8FD9\u6837\u57FA\u672C\u4E0A\u53EF\u4EE5\u4ECE pc \u7AEF\u7684\u63A5\u53E3\u7C98\u8D34\u5185\u5BB9\u5230\u5C0F\u7A0B\u5E8F\u3002\u3002\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",children:"// \u5C01\u88C5\u540E\u7AEF\u8FD4\u56DE\u503C\u7C7B\u578B\nexport type ResponseData<T> = {\n  code: string\n  msg: string\n  data: T\n}\n// \u5B50\u5F53\u4EE5\u8BF7\u6C42\u53C2\u6570\nexport interface CustomRequestOptions extends Partial<UniApp.RequestOptions> {\n  baseURL?: string\n  responseInterceptors?: (res: any) => any\n}\nexport class Request {\n  private baseURL = 'xxx/xxx'\n\n  // \u9ED8\u8BA4\u914D\u7F6E\n  private baseConfig = {\n    // timeout: 5000,\n    // withCredentials: true,\n  }\n  private baseHeader = {\n    Authorization: 'xxx',\n  }\n  private _config: CustomRequestOptions\n\n  // \u8986\u76D6\u9ED8\u8BA4\u914D\u7F6E\n  constructor(config: CustomRequestOptions) {\n    this._config = Object.assign(this.baseConfig, config)\n    if (config.baseURL) {\n      this.baseURL = config.baseURL\n    }\n    if (config.responseInterceptors) {\n      this.responseInterceptors = config.responseInterceptors\n    }\n  }\n\n  // \u8FD4\u56DEfalse\u8868\u793A\u4E0D\u8FDB\u884C\u8BF7\u6C42\n  private requestInterceptors(config: UniApp.RequestOptions): boolean {\n    return true\n  }\n\n  private responseInterceptors(\n    res: UniApp.RequestSuccessCallbackResult\n  ): unknown {\n    const data = res.data as ResponseData<any>\n    if (data?.code.startsWith('s')) {\n      uni.showToast({\n        title: data.msg,\n      })\n    } else {\n      return null\n    }\n    return res.data\n  }\n  // \u5B9A\u4E49\u6838\u5FC3\u8BF7\u6C42\n  public async request(config: UniApp.RequestOptions): Promise<any> {\n    //   \u62E6\u622A\u5668\u62E6\u622A\u65F6\uFF0C\u4E0D\u53D1\u751F\u8BF7\u6C42\n    if (!this.requestInterceptors(config)) {\n      return\n    }\n    return new Promise((resolve, reject) => {\n      uni.request({\n        ...config,\n        url: encodeURI(config.url),\n        header: {\n          ...this.baseHeader,\n          ...config.header,\n        },\n        success: (res) => {\n          const data = this.responseInterceptors(res)\n          if (data) {\n            return resolve(data)\n          }\n        },\n        fail: (res) => {\n          return reject(res)\n        },\n      })\n    })\n  }\n\n  public async get<T = any>(\n    url: string,\n    config?: Omit<UniApp.RequestOptions, 'url'>\n  ): Promise<ResponseData<T>> {\n    return this.request({\n      url: this.baseURL + url,\n      method: 'GET',\n      ...config,\n    })\n  }\n\n  public async post<T = any>(\n    url: string,\n    data?: any,\n    config?: UniApp.RequestOptions\n  ): Promise<ResponseData<T>> {\n    return this.request({\n      url: this.baseURL + url,\n      method: 'POST',\n      data: data,\n      ...config,\n    })\n  }\n}\n\nexport default new Request({})\nexport const requstOrigin = new Request({\n  baseURL: '',\n  responseInterceptors(res) {\n    const data = res.data as ResponseData<any>\n    if (data?.code.startsWith('s')) {\n      uni.showToast({\n        title: data.msg,\n      })\n    } else {\n      return null\n    }\n    //   \u8FD9\u91CC\u5C31\u4E0D\u5BF9getUserPermission\u5355\u72EC\u5224\u65AD\u4E86\n    //   config.url.includes('getUserPermission')\n    return res\n  },\n})\n"})})]})}function g(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}}}]);